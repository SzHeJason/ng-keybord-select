angular.module("ng-keyboard-select",[]).directive("gridGroup",[function(){return{scope:{gridSelectName:"@",gridGroupData:"="},bindToController:!0,controllerAs:"vm",controller:["$element","$attrs",function(ele,attrs){var preIndex,pushNum,nowIndex,vm=this,index=0;return vm.Items=[],vm.itemName="item",vm.addItem=function(item){item.index=index++,vm.Items.push(item)},vm.mulitSelectItem=function(item){nowIndex=item.index,pushNum=Math.abs(nowIndex-preIndex),angular.forEach(vm.Items,function(value,key){if(nowIndex>preIndex)for(preIndex;preIndex<nowIndex;preIndex++)vm.Items[preIndex+1].isSelected=!0;else if(nowIndex<preIndex)for(preIndex;preIndex>nowIndex;preIndex--)vm.Items[preIndex-1].isSelected=!0})},vm.selectItem=function(item){item.isSelected=!item.isSelected,preIndex=item.index},vm.selectSingleItem=function(item){item[vm.gridSelectName]=!item[vm.gridSelectName],angular.forEach(vm.Items,function(value,key){value[vm.gridSelectName]&&item.$$hashKey!=value.$$hashKey&&(value[vm.gridSelectName]=!1)}),preIndex=item.index},vm}]}}]).directive("gridSelected",[function(){return{require:"^gridGroup",link:function(scope,ele,attrs,ctrls){var result,item=scope[attrs.gridSelected],itemDisabled=scope[attrs.gridSelectedDisabled],getSelectedItems=function(){result=[];for(var i in ctrls.Items)ctrls.Items[i][ctrls.gridSelectName]&&result.push(ctrls.Items[i]);return result};ctrls.addItem(item),itemDisabled||ele.on("click",function(e){scope.$apply(function(){e.ctrlKey||e.metaKey?ctrls.selectItem(item):e.shiftKey?ctrls.mulitSelectItem(item):ctrls.selectSingleItem(item),result=getSelectedItems(),ctrls.gridGroupData&&(ctrls.gridGroupData=result)})})}}}]).directive("gridCheckAll",["$timeout",function($timeout){return{require:["^gridGroup","^ngModel"],link:function(scope,ele,attrs,ctrls){var gridGroupCtrl=ctrls[0],ngModelCtrl=ctrls[1],isCheck=ngModelCtrl.$viewValue,getSelectItem=function(){$timeout(function(){if(isCheck=ngModelCtrl.$viewValue)for(var i in gridGroupCtrl.Items)gridGroupCtrl.Items[i][gridGroupCtrl.gridSelectName]=!0;else for(var i in gridGroupCtrl.Items)gridGroupCtrl.Items[i][gridGroupCtrl.gridSelectName]=!1})};getSelectItem(),ele.on("click",function(){getSelectItem()})}}}]);